//Raymond@HZHL3 ~/code/go/src/github.com/rhu1/scribble-go-runtime
//$ ~/code/eclipse/scribble/github.com/rhu1-go/scribble-java/bin/scribblec-param.sh test/httpget/HTTPget.scr -d test/httpget/ -param Proto1 -param-api Fetcher

module HTTPget;

type <go> "int" from "..." as int;
type <go> "string" from "..." as string;

global protocol Proto1(role Fetcher(k), role Master(k), role Server(k)) {
  //URL(string) from Master[1..1] to Fetcher[1..1]; // Get URL metadata.
  URL(string) from Master[1..1] to Fetcher[1..k]; // Get URL metadata.
  HEAD(string) from Fetcher[1..k] to Server[1..1];
  response(string) from Server[1..1] to Fetcher[1..k]; // Metadata including size.

  // Setup chunk boundaries.
  //FileSize(int) from Fetcher[1..1] to Master[1..1]; // Full file size.
  FileSize(int) from Fetcher[1..k] to Master[1..1]; // Full file size.
  start(int) from Master[1..1] to Fetcher[1..k]; // byte range start.
  end(int) from Master[1..1] to Fetcher[1..k]; // byte range end.

  // GET chunks
  GET(string) from Fetcher[1..k] to Server[1..1];
  Response(string) from Server[1..1] to Fetcher[1..k];

  // Merge all chunks
  merge(string) from Fetcher[1..k] to Master[1..1];
}
